{
  "prompt": "YOU MUST output all files as fenced code blocks, like so\n\n```lang file=\"path/to/file.ts\"\n// file content\n```\n\nDo not ask clarifying questions. Complete the task with the information provided.\n\n---\n\nCreate a Next.js app with Clerk authentication. The application should sync the Clerk Organization slug with the URL.\n\nFor example, a B2B application named \"Petstore\" has two customer organizations: Acmecorp and Widgetco. Each organization uses its name as a slug in the URL:\n\nAcmecorp: https://petstore.example.com/orgs/acmecorp/dashboard\nWidgetco: https://petstore.example.com/orgs/widgetco/dashboard\n",
  "response": "I'll create a Next.js app with Clerk authentication that syncs the organization slug with the URL. This will be a B2B application structure where each organization has its own URL namespace.\n\n```typescript file=\"package.json\"\n{\n  \"name\": \"clerk-org-slug-sync\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\"\n  },\n  \"dependencies\": {\n    \"@clerk/nextjs\": \"^6.12.0\",\n    \"next\": \"15.1.6\",\n    \"react\": \"^19.0.0\",\n    \"react-dom\": \"^19.0.0\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"^22\",\n    \"@types/react\": \"^19\",\n    \"@types/react-dom\": \"^19\",\n    \"eslint\": \"^9\",\n    \"eslint-config-next\": \"15.1.6\",\n    \"typescript\": \"^5\"\n  }\n}\n```\n\n```typescript file=\".env.local.example\"\nNEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...\nCLERK_SECRET_KEY=sk_test_...\nNEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in\nNEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';\nimport { NextResponse } from 'next/server';\n\nconst isPublicRoute = createRouteMatcher([\n  '/sign-in(.*)',\n  '/sign-up(.*)',\n  '/',\n]);\n\nexport default clerkMiddleware(async (auth, req) => {\n  const { userId, orgSlug } = await auth();\n\n  // Allow public routes\n  if (isPublicRoute(req)) {\n    return NextResponse.next();\n  }\n\n  // Require authentication for protected routes\n  if (!userId) {\n    const signInUrl = new URL('/sign-in', req.url);\n    signInUrl.searchParams.set('redirect_url', req.url);\n    return NextResponse.redirect(signInUrl);\n  }\n\n  // Handle organization-scoped routes\n  const pathname = req.nextUrl.pathname;\n  const orgRouteMatch = pathname.match(/^\\/orgs\\/([^\\/]+)/);\n\n  if (orgRouteMatch) {\n    const urlSlug = orgRouteMatch[1];\n\n    // If user has an active org, ensure URL matches\n    if (orgSlug && orgSlug !== urlSlug) {\n      // Redirect to correct org slug\n      const correctedUrl = new URL(req.url);\n      correctedUrl.pathname = pathname.replace(\n        `/orgs/${urlSlug}`,\n        `/orgs/${orgSlug}`\n      );\n      return NextResponse.redirect(correctedUrl);\n    }\n\n    // If URL slug exists but no active org, try to switch to it\n    if (!orgSlug && urlSlug) {\n      // Let the page handle organization switching\n      return NextResponse.next();\n    }\n  }\n\n  return NextResponse.next();\n});\n\nexport const config = {\n  matcher: [\n    // Skip Next.js internals and all static files\n    '/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n    // Always run for API routes\n    '/(api|trpc)(.*)',\n  ],\n};\n```\n\n```typescript file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs';\nimport type { Metadata } from 'next';\nimport './globals.css';\n\nexport const metadata: Metadata = {\n  title: 'Petstore - B2B Platform',\n  description: 'Multi-organization B2B application with Clerk',\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>{children}</body>\n      </html>\n    </ClerkProvider>\n  );\n}\n```\n\n```css file=\"app/globals.css\"\n* {\n  box-sizing: border-box;\n  padding: 0;\n  margin: 0;\n}\n\nhtml,\nbody {\n  max-width: 100vw;\n  overflow-x: hidden;\n}\n\nbody {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\na {\n  color: inherit;\n  text-decoration: none;\n}\n```\n\n```typescript file=\"app/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\nimport Link from 'next/link';\n\nexport default async function HomePage() {\n  const { userId, orgSlug } = await auth();\n\n  // If authenticated and has an org, redirect to their dashboard\n  if (userId && orgSlug) {\n    redirect(`/orgs/${orgSlug}/dashboard`);\n  }\n\n  // If authenticated but no org, redirect to org selection\n  if (userId && !orgSlug) {\n    redirect('/select-organization');\n  }\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <header style={{ marginBottom: '3rem' }}>\n        <h1 style={{ fontSize: '2.5rem', marginBottom: '1rem' }}>\n          Welcome to Petstore\n        </h1>\n        <p style={{ fontSize: '1.25rem', color: '#666' }}>\n          Your B2B platform for managing pet supplies\n        </p>\n      </header>\n\n      <div style={{ display: 'flex', gap: '1rem' }}>\n        <Link\n          href=\"/sign-in\"\n          style={{\n            padding: '0.75rem 1.5rem',\n            backgroundColor: '#0070f3',\n            color: 'white',\n            borderRadius: '0.5rem',\n            fontWeight: '500',\n          }}\n        >\n          Sign In\n        </Link>\n        <Link\n          href=\"/sign-up\"\n          style={{\n            padding: '0.75rem 1.5rem',\n            backgroundColor: '#eaeaea',\n            color: '#000',\n            borderRadius: '0.5rem',\n            fontWeight: '500',\n          }}\n        >\n          Sign Up\n        </Link>\n      </div>\n\n      <section style={{ marginTop: '4rem' }}>\n        <h2 style={{ fontSize: '1.75rem', marginBottom: '1rem' }}>\n          Multi-Organization Support\n        </h2>\n        <p style={{ marginBottom: '1rem', lineHeight: '1.6' }}>\n          Each organization gets its own dedicated workspace with a custom URL:\n        </p>\n        <ul style={{ listStyle: 'disc', marginLeft: '2rem', lineHeight: '2' }}>\n          <li>\n            <code style={{ backgroundColor: '#f5f5f5', padding: '0.25rem 0.5rem' }}>\n              /orgs/acmecorp/dashboard\n            </code>\n          </li>\n          <li>\n            <code style={{ backgroundColor: '#f5f5f5', padding: '0.25rem 0.5rem' }}>\n              /orgs/widgetco/dashboard\n            </code>\n          </li>\n        </ul>\n      </section>\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/sign-in/[[...sign-in]]/page.tsx\"\nimport { SignIn } from '@clerk/nextjs';\n\nexport default function SignInPage() {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '100vh',\n        padding: '2rem',\n      }}\n    >\n      <SignIn />\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/sign-up/[[...sign-up]]/page.tsx\"\nimport { SignUp } from '@clerk/nextjs';\n\nexport default function SignUpPage() {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '100vh',\n        padding: '2rem',\n      }}\n    >\n      <SignUp />\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/select-organization/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\nimport { OrganizationList } from '@clerk/nextjs';\n\nexport default async function SelectOrganizationPage() {\n  const { userId } = await auth();\n\n  if (!userId) {\n    redirect('/sign-in');\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        minHeight: '100vh',\n        padding: '2rem',\n      }}\n    >\n      <h1 style={{ marginBottom: '2rem', fontSize: '2rem' }}>\n        Select or Create an Organization\n      </h1>\n      <OrganizationList\n        hidePersonal\n        afterSelectOrganizationUrl={(org) => `/orgs/${org.slug}/dashboard`}\n        afterCreateOrganizationUrl={(org) => `/orgs/${org.slug}/dashboard`}\n      />\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/layout.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\nimport { OrganizationSwitcher } from './components/OrganizationSwitcher';\n\nexport default async function OrgLayout({\n  children,\n  params,\n}: {\n  children: React.ReactNode;\n  params: Promise<{ slug: string }>;\n}) {\n  const { userId, orgSlug } = await auth();\n  const { slug } = await params;\n\n  if (!userId) {\n    redirect('/sign-in');\n  }\n\n  // If no active org, redirect to selection\n  if (!orgSlug) {\n    redirect('/select-organization');\n  }\n\n  // Ensure URL slug matches active org\n  if (orgSlug !== slug) {\n    redirect(`/orgs/${orgSlug}/dashboard`);\n  }\n\n  return (\n    <div>\n      <nav\n        style={{\n          padding: '1rem 2rem',\n          borderBottom: '1px solid #eaeaea',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: '2rem' }}>\n          <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>Petstore</h1>\n          <div style={{ display: 'flex', gap: '1rem' }}>\n            <a\n              href={`/orgs/${slug}/dashboard`}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              Dashboard\n            </a>\n            <a\n              href={`/orgs/${slug}/products`}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              Products\n            </a>\n            <a\n              href={`/orgs/${slug}/orders`}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              Orders\n            </a>\n          </div>\n        </div>\n        <OrganizationSwitcher currentSlug={slug} />\n      </nav>\n      <main>{children}</main>\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/components/OrganizationSwitcher.tsx\"\n'use client';\n\nimport { OrganizationSwitcher as ClerkOrgSwitcher } from '@clerk/nextjs';\nimport { useRouter } from 'next/navigation';\n\nexport function OrganizationSwitcher({ currentSlug }: { currentSlug: string }) {\n  const router = useRouter();\n\n  return (\n    <ClerkOrgSwitcher\n      hidePersonal\n      afterSelectOrganizationUrl={(org) => {\n        // Navigate to the new org's dashboard\n        router.push(`/orgs/${org.slug}/dashboard`);\n        return `/orgs/${org.slug}/dashboard`;\n      }}\n    />\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/dashboard/page.tsx\"\nimport { auth, clerkClient } from '@clerk/nextjs/server';\n\nexport default async function DashboardPage({\n  params,\n}: {\n  params: Promise<{ slug: string }>;\n}) {\n  const { userId, orgId } = await auth();\n  const { slug } = await params;\n\n  let organizationName = slug;\n\n  if (orgId) {\n    const client = await clerkClient();\n    const organization = await client.organizations.getOrganization({\n      organizationId: orgId,\n    });\n    organizationName = organization.name;\n  }\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <header style={{ marginBottom: '2rem' }}>\n        <h1 style={{ fontSize: '2rem', marginBottom: '0.5rem' }}>\n          {organizationName} Dashboard\n        </h1>\n        <p style={{ color: '#666' }}>\n          URL: <code style={{ backgroundColor: '#f5f5f5', padding: '0.25rem 0.5rem' }}>\n            /orgs/{slug}/dashboard\n          </code>\n        </p>\n      </header>\n\n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fit, minmax(250px, 1fr))', gap: '1.5rem' }}>\n        <div style={{ padding: '1.5rem', border: '1px solid #eaeaea', borderRadius: '0.5rem' }}>\n          <h3 style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}>Total Orders</h3>\n          <p style={{ fontSize: '2rem', fontWeight: 'bold', color: '#0070f3' }}>124</p>\n        </div>\n        <div style={{ padding: '1.5rem', border: '1px solid #eaeaea', borderRadius: '0.5rem' }}>\n          <h3 style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}>Products</h3>\n          <p style={{ fontSize: '2rem', fontWeight: 'bold', color: '#0070f3' }}>1,234</p>\n        </div>\n        <div style={{ padding: '1.5rem', border: '1px solid #eaeaea', borderRadius: '0.5rem' }}>\n          <h3 style={{ fontSize: '1.25rem', marginBottom: '0.5rem' }}>Team Members</h3>\n          <p style={{ fontSize: '2rem', fontWeight: 'bold', color: '#0070f3' }}>8</p>\n        </div>\n      </div>\n\n      <section style={{ marginTop: '3rem' }}>\n        <h2 style={{ fontSize: '1.5rem', marginBottom: '1rem' }}>Recent Activity</h2>\n        <div style={{ border: '1px solid #eaeaea', borderRadius: '0.5rem', overflow: 'hidden' }}>\n          <table style={{ width: '100%', borderCollapse: 'collapse' }}>\n            <thead style={{ backgroundColor: '#f5f5f5' }}>\n              <tr>\n                <th style={{ padding: '1rem', textAlign: 'left' }}>Date</th>\n                <th style={{ padding: '1rem', textAlign: 'left' }}>Activity</th>\n                <th style={{ padding: '1rem', textAlign: 'left' }}>User</th>\n              </tr>\n            </thead>\n            <tbody>\n              <tr style={{ borderTop: '1px solid #eaeaea' }}>\n                <td style={{ padding: '1rem' }}>2026-01-20</td>\n                <td style={{ padding: '1rem' }}>New order placed</td>\n                <td style={{ padding: '1rem' }}>john@{slug}.com</td>\n              </tr>\n              <tr style={{ borderTop: '1px solid #eaeaea' }}>\n                <td style={{ padding: '1rem' }}>2026-01-19</td>\n                <td style={{ padding: '1rem' }}>Product updated</td>\n                <td style={{ padding: '1rem' }}>jane@{slug}.com</td>\n              </tr>\n              <tr style={{ borderTop: '1px solid #eaeaea' }}>\n                <td style={{ padding: '1rem' }}>2026-01-18</td>\n                <td style={{ padding: '1rem' }}>Team member invited</td>\n                <td style={{ padding: '1rem' }}>admin@{slug}.com</td>\n              </tr>\n            </tbody>\n          </table>\n        </div>\n      </section>\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/products/page.tsx\"\nexport default async function ProductsPage({\n  params,\n}: {\n  params: Promise<{ slug: string }>;\n}) {\n  const { slug } = await params;\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <h1 style={{ fontSize: '2rem', marginBottom: '2rem' }}>Products</h1>\n      \n      <div style={{ display: 'grid', gridTemplateColumns: 'repeat(auto-fill, minmax(250px, 1fr))', gap: '1.5rem' }}>\n        {[\n          { name: 'Premium Dog Food', price: '$49.99' },\n          { name: 'Cat Scratching Post', price: '$29.99' },\n          { name: 'Bird Cage', price: '$89.99' },\n          { name: 'Fish Tank Filter', price: '$39.99' },\n        ].map((product) => (\n          <div\n            key={product.name}\n            style={{\n              padding: '1.5rem',\n              border: '1px solid #eaeaea',\n              borderRadius: '0.5rem',\n            }}\n          >\n            <div\n              style={{\n                width: '100%',\n                height: '150px',\n                backgroundColor: '#f5f5f5',\n                marginBottom: '1rem',\n                borderRadius: '0.25rem',\n              }}\n            />\n            <h3 style={{ fontSize: '1.125rem', marginBottom: '0.5rem' }}>\n              {product.name}\n            </h3>\n            <p style={{ fontSize: '1.25rem', fontWeight: 'bold', color: '#0070f3' }}>\n              {product.price}\n            </p>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/orders/page.tsx\"\nexport default async function OrdersPage({\n  params,\n}: {\n  params: Promise<{ slug: string }>;\n}) {\n  const { slug } = await params;\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <h1 style={{ fontSize: '2rem', marginBottom: '2rem' }}>Orders</h1>\n\n      <div style={{ border: '1px solid #eaeaea', borderRadius: '0.5rem', overflow: 'hidden' }}>\n        <table style={{ width: '100%', borderCollapse: 'collapse' }}>\n          <thead style={{ backgroundColor: '#f5f5f5' }}>\n            <tr>\n              <th style={{ padding: '1rem', textAlign: 'left' }}>Order ID</th>\n              <th style={{ padding: '1rem', textAlign: 'left' }}>Date</th>\n              <th style={{ padding: '1rem', textAlign: 'left' }}>Total</th>\n              <th style={{ padding: '1rem', textAlign: 'left' }}>Status</th>\n            </tr>\n          </thead>\n          <tbody>\n            {[\n              { id: 'ORD-001', date: '2026-01-20', total: '$149.97', status: 'Processing' },\n              { id: 'ORD-002', date: '2026-01-19', total: '$89.99', status: 'Shipped' },\n              { id: 'ORD-003', date: '2026-01-18', total: '$199.98', status: 'Delivered' },\n              { id: 'ORD-004', date: '2026-01-17', total: '$49.99', status: 'Delivered' },\n            ].map((order) => (\n              <tr key={order.id} style={{ borderTop: '1px solid #eaeaea' }}>\n                <td style={{ padding: '1rem', fontWeight: '500' }}>{order.id}</td>\n                <td style={{ padding: '1rem' }}>{order.date}</td>\n                <td style={{ padding: '1rem' }}>{order.total}</td>\n                <td style={{ padding: '1rem' }}>\n                  <span\n                    style={{\n                      padding: '0.25rem 0.75rem',\n                      borderRadius: '9999px',\n                      fontSize: '0.875rem',\n                      backgroundColor:\n                        order.status === 'Delivered'\n                          ? '#d4edda'\n                          : order.status === 'Shipped'\n                          ? '#d1ecf1'\n                          : '#fff3cd',\n                      color:\n                        order.status === 'Delivered'\n                          ? '#155724'\n                          : order.status === 'Shipped'\n                          ? '#0c5460'\n                          : '#856404',\n                    }}\n                  >\n                    {order.status}\n                  </span>\n                </td>\n              </tr>\n            ))}\n          </tbody>\n        </table>\n      </div>\n    </div>\n  );\n}\n```\n\n```typescript file=\"tsconfig.json\"\n{\n  \"compilerOptions\": {\n    \"target\": \"ES2017\",\n    \"lib\": [\"dom\", \"dom.iterable\", \"esnext\"],\n    \"allowJs\": true,\n    \"skipLibCheck\": true,\n    \"strict\": true,\n    \"noEmit\": true,\n    \"esModuleInterop\": true,\n    \"module\": \"esnext\",\n    \"moduleResolution\": \"bundler\",\n    \"resolveJsonModule\": true,\n    \"isolatedModules\": true,\n    \"jsx\": \"preserve\",\n    \"incremental\": true,\n    \"plugins\": [\n      {\n        \"name\": \"next\"\n      }\n    ],\n    \"paths\": {\n      \"@/*\": [\"./*\"]\n    }\n  },\n  \"include\": [\"next-env.d.ts\", \"**/*.ts\", \"**/*.tsx\", \".next/types/**/*.ts\"],\n  \"exclude\": [\"node_modules\"]\n}\n```\n\n```typescript file=\"next.config.ts\"\nimport type { NextConfig } from 'next';\n\nconst nextConfig: NextConfig = {\n  /* config options here */\n};\n\nexport default nextConfig;\n```\n\n```markdown file=\"README.md\"\n# Clerk Organization Slug Sync - Next.js App\n\nA Next.js 15 application demonstrating Clerk authentication with organization slug synchronization in the URL.\n\n## Features\n\n- **Organization-based URL routing**: Each organization gets its own URL namespace (`/orgs/{slug}/...`)\n- **Automatic slug synchronization**: URLs stay in sync with the active Clerk organization\n- **Organization switcher**: Seamlessly switch between organizations with automatic URL updates\n- **Protected routes**: Authentication and organization membership required for org-scoped pages\n- **Multi-organization support**: Users can belong to multiple organizations\n\n## Getting Started\n\n### 1. Install Dependencies\n\n```bash\nnpm install\n# or\npnpm install\n```\n\n### 2. Set up Clerk\n\n1. Create a Clerk account at [clerk.com](https://clerk.com)\n2. Create a new application\n3. Enable Organizations in your Clerk dashboard\n4. Copy your API keys\n\n### 3. Configure Environment Variables\n\nCreate a `.env.local` file:\n\n```bash\nNEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...\nCLERK_SECRET_KEY=sk_test_...\nNEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in\nNEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up\n```\n\n### 4. Run the Development Server\n\n```bash\nnpm run dev\n```\n\nOpen [http://localhost:3000](http://localhost:3000) in your browser.\n\n## How It Works\n\n### URL Structure\n\n- Home: `/`\n- Sign in: `/sign-in`\n- Sign up: `/sign-up`\n- Organization selection: `/select-organization`\n- Organization dashboard: `/orgs/{slug}/dashboard`\n- Organization products: `/orgs/{slug}/products`\n- Organization orders: `/orgs/{slug}/orders`\n\n### Middleware Logic\n\nThe `middleware.ts` file handles:\n\n1. **Authentication check**: Redirects unauthenticated users to sign-in\n2. **Organization slug validation**: Ensures URL slug matches active organization\n3. **Automatic redirection**: Redirects to correct URL if slug mismatch detected\n\n### Key Components\n\n- **OrganizationSwitcher**: Allows users to switch between organizations, automatically updates URL\n- **Layout**: Wraps organization pages with navigation and org switcher\n- **Protected routes**: All `/orgs/{slug}/*` routes require authentication and org membership\n\n## Testing the Application\n\n1. **Sign up** and create an account\n2. **Create or join organizations** with different slugs (e.g., \"acmecorp\", \"widgetco\")\n3. **Navigate** to `/orgs/acmecorp/dashboard` - you'll see Acmecorp's dashboard\n4. **Switch organizations** using the OrganizationSwitcher - URL updates automatically\n5. **Try to access** another org's URL - middleware redirects to your active org\n\n## Learn More\n\n- [Next.js Documentation](https://nextjs.org/docs)\n- [Clerk Documentation](https://clerk.com/docs)\n- [Clerk Organizations](https://clerk.com/docs/organizations/overview)\n\n## Deployment\n\nDeploy on [Vercel](https://vercel.com):\n\n```bash\nnpm run build\n```\n\nMake sure to add your environment variables in the Vercel dashboard.\n```\n\nThis Next.js application provides a complete B2B platform with Clerk authentication and organization slug synchronization. Key features:\n\n1. **Organization-scoped URLs**: Each organization has its own URL namespace (e.g., `/orgs/acmecorp/dashboard`)\n\n2. **Automatic synchronization**: The middleware ensures the URL slug always matches the active Clerk organization\n\n3. **Organization switcher**: Users can switch between organizations, and the URL updates automatically\n\n4. **Protected routes**: All organization pages require authentication and active organization membership\n\n5. **Multiple pages**: Dashboard, products, and orders pages demonstrate how to build organization-scoped features\n\nTo get started:\n1. Run `npm install` (or `pnpm install`)\n2. Set up your Clerk application and enable Organizations\n3. Add your Clerk API keys to `.env.local`\n4. Run `npm run dev`\n",
  "graders": [
    [
      "import_package",
      true
    ],
    [
      "import_function",
      true
    ],
    [
      "middleware_file_name",
      true
    ],
    [
      "orgs_dynamic_route",
      true
    ],
    [
      "package_json_clerk_version",
      true
    ],
    [
      "environment_variables",
      true
    ],
    [
      "org_slug_from_await_auth",
      true
    ]
  ],
  "transcript": "# Claude Code Agent Transcript\n\n## Execution Info\n- **Duration**: 80.98s\n- **Exit Code**: 0\n- **Success**: true\n\n## Prompt\n```markdown\nYOU MUST output all files as fenced code blocks, like so\n\n```lang file=\"path/to/file.ts\"\n// file content\n```\n\nDo not ask clarifying questions. Complete the task with the information provided.\n\n---\n\nCreate a Next.js app with Clerk authentication. The application should sync the Clerk Organization slug with the URL.\n\nFor example, a B2B application named \"Petstore\" has two customer organizations: Acmecorp and Widgetco. Each organization uses its name as a slug in the URL:\n\nAcmecorp: https://petstore.example.com/orgs/acmecorp/dashboard\nWidgetco: https://petstore.example.com/orgs/widgetco/dashboard\n```\n\n## Output\n```\nI'll create a Next.js app with Clerk authentication that syncs the organization slug with the URL. This will be a B2B application structure where each organization has its own URL namespace.\n\n```typescript file=\"package.json\"\n{\n  \"name\": \"clerk-org-slug-sync\",\n  \"version\": \"0.1.0\",\n  \"private\": true,\n  \"scripts\": {\n    \"dev\": \"next dev\",\n    \"build\": \"next build\",\n    \"start\": \"next start\",\n    \"lint\": \"next lint\"\n  },\n  \"dependencies\": {\n    \"@clerk/nextjs\": \"^6.12.0\",\n    \"next\": \"15.1.6\",\n    \"react\": \"^19.0.0\",\n    \"react-dom\": \"^19.0.0\"\n  },\n  \"devDependencies\": {\n    \"@types/node\": \"^22\",\n    \"@types/react\": \"^19\",\n    \"@types/react-dom\": \"^19\",\n    \"eslint\": \"^9\",\n    \"eslint-config-next\": \"15.1.6\",\n    \"typescript\": \"^5\"\n  }\n}\n```\n\n```typescript file=\".env.local.example\"\nNEXT_PUBLIC_CLERK_PUBLISHABLE_KEY=pk_test_...\nCLERK_SECRET_KEY=sk_test_...\nNEXT_PUBLIC_CLERK_SIGN_IN_URL=/sign-in\nNEXT_PUBLIC_CLERK_SIGN_UP_URL=/sign-up\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';\nimport { NextResponse } from 'next/server';\n\nconst isPublicRoute = createRouteMatcher([\n  '/sign-in(.*)',\n  '/sign-up(.*)',\n  '/',\n]);\n\nexport default clerkMiddleware(async (auth, req) => {\n  const { userId, orgSlug } = await auth();\n\n  // Allow public routes\n  if (isPublicRoute(req)) {\n    return NextResponse.next();\n  }\n\n  // Require authentication for protected routes\n  if (!userId) {\n    const signInUrl = new URL('/sign-in', req.url);\n    signInUrl.searchParams.set('redirect_url', req.url);\n    return NextResponse.redirect(signInUrl);\n  }\n\n  // Handle organization-scoped routes\n  const pathname = req.nextUrl.pathname;\n  const orgRouteMatch = pathname.match(/^\\/orgs\\/([^\\/]+)/);\n\n  if (orgRouteMatch) {\n    const urlSlug = orgRouteMatch[1];\n\n    // If user has an active org, ensure URL matches\n    if (orgSlug && orgSlug !== urlSlug) {\n      // Redirect to correct org slug\n      const correctedUrl = new URL(req.url);\n      correctedUrl.pathname = pathname.replace(\n        `/orgs/${urlSlug}`,\n        `/orgs/${orgSlug}`\n      );\n      return NextResponse.redirect(correctedUrl);\n    }\n\n    // If URL slug exists but no active org, try to switch to it\n    if (!orgSlug && urlSlug) {\n      // Let the page handle organization switching\n      return NextResponse.next();\n    }\n  }\n\n  return NextResponse.next();\n});\n\nexport const config = {\n  matcher: [\n    // Skip Next.js internals and all static files\n    '/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n    // Always run for API routes\n    '/(api|trpc)(.*)',\n  ],\n};\n```\n\n```typescript file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs';\nimport type { Metadata } from 'next';\nimport './globals.css';\n\nexport const metadata: Metadata = {\n  title: 'Petstore - B2B Platform',\n  description: 'Multi-organization B2B application with Clerk',\n};\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>{children}</body>\n      </html>\n    </ClerkProvider>\n  );\n}\n```\n\n```css file=\"app/globals.css\"\n* {\n  box-sizing: border-box;\n  padding: 0;\n  margin: 0;\n}\n\nhtml,\nbody {\n  max-width: 100vw;\n  overflow-x: hidden;\n}\n\nbody {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',\n    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',\n    sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n}\n\na {\n  color: inherit;\n  text-decoration: none;\n}\n```\n\n```typescript file=\"app/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\nimport Link from 'next/link';\n\nexport default async function HomePage() {\n  const { userId, orgSlug } = await auth();\n\n  // If authenticated and has an org, redirect to their dashboard\n  if (userId && orgSlug) {\n    redirect(`/orgs/${orgSlug}/dashboard`);\n  }\n\n  // If authenticated but no org, redirect to org selection\n  if (userId && !orgSlug) {\n    redirect('/select-organization');\n  }\n\n  return (\n    <div style={{ padding: '2rem', maxWidth: '1200px', margin: '0 auto' }}>\n      <header style={{ marginBottom: '3rem' }}>\n        <h1 style={{ fontSize: '2.5rem', marginBottom: '1rem' }}>\n          Welcome to Petstore\n        </h1>\n        <p style={{ fontSize: '1.25rem', color: '#666' }}>\n          Your B2B platform for managing pet supplies\n        </p>\n      </header>\n\n      <div style={{ display: 'flex', gap: '1rem' }}>\n        <Link\n          href=\"/sign-in\"\n          style={{\n            padding: '0.75rem 1.5rem',\n            backgroundColor: '#0070f3',\n            color: 'white',\n            borderRadius: '0.5rem',\n            fontWeight: '500',\n          }}\n        >\n          Sign In\n        </Link>\n        <Link\n          href=\"/sign-up\"\n          style={{\n            padding: '0.75rem 1.5rem',\n            backgroundColor: '#eaeaea',\n            color: '#000',\n            borderRadius: '0.5rem',\n            fontWeight: '500',\n          }}\n        >\n          Sign Up\n        </Link>\n      </div>\n\n      <section style={{ marginTop: '4rem' }}>\n        <h2 style={{ fontSize: '1.75rem', marginBottom: '1rem' }}>\n          Multi-Organization Support\n        </h2>\n        <p style={{ marginBottom: '1rem', lineHeight: '1.6' }}>\n          Each organization gets its own dedicated workspace with a custom URL:\n        </p>\n        <ul style={{ listStyle: 'disc', marginLeft: '2rem', lineHeight: '2' }}>\n          <li>\n            <code style={{ backgroundColor: '#f5f5f5', padding: '0.25rem 0.5rem' }}>\n              /orgs/acmecorp/dashboard\n            </code>\n          </li>\n          <li>\n            <code style={{ backgroundColor: '#f5f5f5', padding: '0.25rem 0.5rem' }}>\n              /orgs/widgetco/dashboard\n            </code>\n          </li>\n        </ul>\n      </section>\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/sign-in/[[...sign-in]]/page.tsx\"\nimport { SignIn } from '@clerk/nextjs';\n\nexport default function SignInPage() {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '100vh',\n        padding: '2rem',\n      }}\n    >\n      <SignIn />\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/sign-up/[[...sign-up]]/page.tsx\"\nimport { SignUp } from '@clerk/nextjs';\n\nexport default function SignUpPage() {\n  return (\n    <div\n      style={{\n        display: 'flex',\n        justifyContent: 'center',\n        alignItems: 'center',\n        minHeight: '100vh',\n        padding: '2rem',\n      }}\n    >\n      <SignUp />\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/select-organization/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\nimport { OrganizationList } from '@clerk/nextjs';\n\nexport default async function SelectOrganizationPage() {\n  const { userId } = await auth();\n\n  if (!userId) {\n    redirect('/sign-in');\n  }\n\n  return (\n    <div\n      style={{\n        display: 'flex',\n        flexDirection: 'column',\n        alignItems: 'center',\n        justifyContent: 'center',\n        minHeight: '100vh',\n        padding: '2rem',\n      }}\n    >\n      <h1 style={{ marginBottom: '2rem', fontSize: '2rem' }}>\n        Select or Create an Organization\n      </h1>\n      <OrganizationList\n        hidePersonal\n        afterSelectOrganizationUrl={(org) => `/orgs/${org.slug}/dashboard`}\n        afterCreateOrganizationUrl={(org) => `/orgs/${org.slug}/dashboard`}\n      />\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/layout.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\nimport { OrganizationSwitcher } from './components/OrganizationSwitcher';\n\nexport default async function OrgLayout({\n  children,\n  params,\n}: {\n  children: React.ReactNode;\n  params: Promise<{ slug: string }>;\n}) {\n  const { userId, orgSlug } = await auth();\n  const { slug } = await params;\n\n  if (!userId) {\n    redirect('/sign-in');\n  }\n\n  // If no active org, redirect to selection\n  if (!orgSlug) {\n    redirect('/select-organization');\n  }\n\n  // Ensure URL slug matches active org\n  if (orgSlug !== slug) {\n    redirect(`/orgs/${orgSlug}/dashboard`);\n  }\n\n  return (\n    <div>\n      <nav\n        style={{\n          padding: '1rem 2rem',\n          borderBottom: '1px solid #eaeaea',\n          display: 'flex',\n          justifyContent: 'space-between',\n          alignItems: 'center',\n        }}\n      >\n        <div style={{ display: 'flex', alignItems: 'center', gap: '2rem' }}>\n          <h1 style={{ fontSize: '1.5rem', fontWeight: 'bold' }}>Petstore</h1>\n          <div style={{ display: 'flex', gap: '1rem' }}>\n            <a\n              href={`/orgs/${slug}/dashboard`}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              Dashboard\n            </a>\n            <a\n              href={`/orgs/${slug}/products`}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              Products\n            </a>\n            <a\n              href={`/orgs/${slug}/orders`}\n              style={{ padding: '0.5rem 1rem' }}\n            >\n              Orders\n            </a>\n          </div>\n        </div>\n        <OrganizationSwitcher currentSlug={slug} />\n      </nav>\n      <main>{children}</main>\n    </div>\n  );\n}\n```\n\n```typescript file=\"app/orgs/[slug]/components/OrganizationSwitcher.tsx\"\n'use client';\n\nimport { OrganizationSwitcher as ClerkOrgSwitcher } from '@clerk/nextjs';\nimport { useRouter } from 'next/navigation';\n\nexport function OrganizationSwitcher({ currentSlug }: { currentSlug: string }) {\n  const router = useRouter();\n\n  return (\n    <ClerkOrgSwitcher\n      hidePersonal\n      afterSelectOrganizationUrl={(org) => {\n        // Navigate to the new org's dashboard\n        router.push(`/orgs/${org.slug}/dashboard`);\n        return `/orgs/${org.slug}/dashboard`;\n      }}\n\n... (truncated)\n```\n\n## Grader Results\n**Score: 100.0%** (7/7)\n\n| Grader | Result |\n|--------|--------|\n| import_package | PASS |\n| import_function | PASS |\n| middleware_file_name | PASS |\n| orgs_dynamic_route | PASS |\n| package_json_clerk_version | PASS |\n| environment_variables | PASS |\n| org_slug_from_await_auth | PASS |\n"
}