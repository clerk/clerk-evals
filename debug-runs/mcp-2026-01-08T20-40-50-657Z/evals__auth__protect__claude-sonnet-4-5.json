{
  "prompt": "# Task\n\nBuild a Clerk-enabled Next.js App Router admin area that enforces both authentication and authorization for an organization settings page.\n",
  "response": "I'll help you build a Clerk-enabled Next.js App Router admin area with authentication and authorization for an organization settings page. Let me first check what relevant Clerk SDK snippets are available.\n\nLet me create a comprehensive Clerk-enabled Next.js App Router admin area with authentication and authorization for you:\n\n```typescript file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs'\nimport './globals.css'\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>{children}</body>\n      </html>\n    </ClerkProvider>\n  )\n}\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'\n\nconst isPublicRoute = createRouteMatcher([\n  '/sign-in(.*)',\n  '/sign-up(.*)',\n  '/',\n])\n\nconst isAdminRoute = createRouteMatcher([\n  '/admin(.*)',\n])\n\nexport default clerkMiddleware(async (auth, request) => {\n  // Protect all non-public routes\n  if (!isPublicRoute(request)) {\n    await auth.protect()\n  }\n\n  // Additional protection for admin routes\n  if (isAdminRoute(request)) {\n    await auth.protect((has) => {\n      return has({ role: 'org:admin' }) || has({ role: 'org:owner' })\n    })\n  }\n})\n\nexport const config = {\n  matcher: [\n    // Skip Next.js internals and all static files\n    '/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n    // Always run for API routes\n    '/(api|trpc)(.*)',\n  ],\n}\n```\n\n```typescript file=\"app/admin/layout.tsx\"\nimport { auth } from '@clerk/nextjs/server'\nimport { OrganizationSwitcher, UserButton } from '@clerk/nextjs'\nimport { redirect } from 'next/navigation'\n\nexport default async function AdminLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const { userId, orgId, orgRole } = await auth()\n\n  // Ensure user is authenticated\n  if (!userId) {\n    redirect('/sign-in')\n  }\n\n  // Ensure user is in an organization\n  if (!orgId) {\n    redirect('/select-organization')\n  }\n\n  // Ensure user has admin or owner role\n  if (orgRole !== 'org:admin' && orgRole !== 'org:owner') {\n    redirect('/unauthorized')\n  }\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/* Admin Navigation */}\n      <nav className=\"bg-white border-b border-gray-200\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between h-16\">\n            <div className=\"flex items-center\">\n              <h1 className=\"text-xl font-bold text-gray-900\">Admin Area</h1>\n            </div>\n            <div className=\"flex items-center gap-4\">\n              <OrganizationSwitcher\n                hidePersonal\n                afterSelectOrganizationUrl=\"/admin\"\n                appearance={{\n                  elements: {\n                    rootBox: 'flex items-center',\n                  },\n                }}\n              />\n              <UserButton afterSignOutUrl=\"/\" />\n            </div>\n          </div>\n        </div>\n      </nav>\n\n      {/* Admin Sidebar */}\n      <div className=\"flex\">\n        <aside className=\"w-64 bg-white border-r border-gray-200 min-h-[calc(100vh-4rem)]\">\n          <nav className=\"px-4 py-6 space-y-2\">\n            <a\n              href=\"/admin\"\n              className=\"block px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md\"\n            >\n              Dashboard\n            </a>\n            <a\n              href=\"/admin/settings\"\n              className=\"block px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md\"\n            >\n              Organization Settings\n            </a>\n            <a\n              href=\"/admin/members\"\n              className=\"block px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md\"\n            >\n              Members\n            </a>\n            <a\n              href=\"/admin/billing\"\n              className=\"block px-4 py-2 text-gray-700 hover:bg-gray-100 rounded-md\"\n            >\n              Billing\n            </a>\n          </nav>\n        </aside>\n\n        {/* Main Content */}\n        <main className=\"flex-1 p-8\">\n          {children}\n        </main>\n      </div>\n    </div>\n  )\n}\n```\n\n```typescript file=\"app/admin/page.tsx\"\nimport { auth } from '@clerk/nextjs/server'\nimport { OrganizationProfile } from '@clerk/nextjs'\n\nexport default async function AdminDashboard() {\n  const { orgId, orgRole, userId } = await auth()\n\n  return (\n    <div>\n      <h1 className=\"text-3xl font-bold text-gray-900 mb-6\">\n        Admin Dashboard\n      </h1>\n      \n      <div className=\"bg-white rounded-lg shadow p-6 mb-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Access Information</h2>\n        <dl className=\"grid grid-cols-1 gap-4\">\n          <div>\n            <dt className=\"text-sm font-medium text-gray-500\">User ID</dt>\n            <dd className=\"mt-1 text-sm text-gray-900\">{userId}</dd>\n          </div>\n          <div>\n            <dt className=\"text-sm font-medium text-gray-500\">Organization ID</dt>\n            <dd className=\"mt-1 text-sm text-gray-900\">{orgId}</dd>\n          </div>\n          <div>\n            <dt className=\"text-sm font-medium text-gray-500\">Role</dt>\n            <dd className=\"mt-1 text-sm text-gray-900\">\n              <span className=\"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-100 text-green-800\">\n                {orgRole}\n              </span>\n            </dd>\n          </div>\n        </dl>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow p-6\">\n        <h2 className=\"text-xl font-semibold mb-4\">Quick Stats</h2>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-4\">\n          <div className=\"border border-gray-200 rounded-lg p-4\">\n            <p className=\"text-sm text-gray-500\">Total Members</p>\n            <p className=\"text-2xl font-bold text-gray-900\">12</p>\n          </div>\n          <div className=\"border border-gray-200 rounded-lg p-4\">\n            <p className=\"text-sm text-gray-500\">Active Projects</p>\n            <p className=\"text-2xl font-bold text-gray-900\">8</p>\n          </div>\n          <div className=\"border border-gray-200 rounded-lg p-4\">\n            <p className=\"text-sm text-gray-500\">Plan</p>\n            <p className=\"text-2xl font-bold text-gray-900\">Pro</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  )\n}\n```\n\n```typescript file=\"app/admin/settings/page.tsx\"\nimport { auth } from '@clerk/nextjs/server'\nimport { OrganizationProfile } from '@clerk/nextjs'\nimport { SettingsForm } from './settings-form'\n\nexport default async function OrganizationSettingsPage() {\n  const { orgId, orgRole } = await auth()\n\n  return (\n    <div>\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n          Organization Settings\n        </h1>\n        <p className=\"text-gray-600\">\n          Manage your organization's settings and preferences\n        </p>\n      </div>\n\n      {/* Custom Settings Form */}\n      <div className=\"bg-white rounded-lg shadow mb-8\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">\n            General Settings\n          </h2>\n        </div>\n        <div className=\"p-6\">\n          <SettingsForm />\n        </div>\n      </div>\n\n      {/* Clerk Organization Profile Component */}\n      <div className=\"bg-white rounded-lg shadow\">\n        <div className=\"px-6 py-4 border-b border-gray-200\">\n          <h2 className=\"text-xl font-semibold text-gray-900\">\n            Organization Profile\n          </h2>\n        </div>\n        <div className=\"p-6\">\n          <OrganizationProfile\n            appearance={{\n              elements: {\n                rootBox: 'w-full',\n                cardBox: 'shadow-none',\n              },\n            }}\n          />\n        </div>\n      </div>\n    </div>\n  )\n}\n```\n\n```typescript file=\"app/admin/settings/settings-form.tsx\"\n'use client'\n\nimport { useOrganization } from '@clerk/nextjs'\nimport { useState } from 'react'\n\nexport function SettingsForm() {\n  const { organization, isLoaded } = useOrganization()\n  const [isSaving, setIsSaving] = useState(false)\n  const [message, setMessage] = useState('')\n\n  const handleSubmit = async (e: React.FormEvent<HTMLFormElement>) => {\n    e.preventDefault()\n    setIsSaving(true)\n    setMessage('')\n\n    const formData = new FormData(e.currentTarget)\n    const name = formData.get('name') as string\n\n    try {\n      if (organization) {\n        await organization.update({ name })\n        setMessage('Settings saved successfully!')\n      }\n    } catch (error) {\n      setMessage('Error saving settings')\n      console.error(error)\n    } finally {\n      setIsSaving(false)\n    }\n  }\n\n  if (!isLoaded) {\n    return <div>Loading...</div>\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-6\">\n      <div>\n        <label\n          htmlFor=\"name\"\n          className=\"block text-sm font-medium text-gray-700 mb-2\"\n        >\n          Organization Name\n        </label>\n        <input\n          type=\"text\"\n          id=\"name\"\n          name=\"name\"\n          defaultValue={organization?.name}\n          className=\"w-full px-4 py-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent\"\n          required\n        />\n      </div>\n\n      <div>\n        <label\n          htmlFor=\"slug\"\n          className=\"block text-sm font-medium text-gray-700 mb-2\"\n        >\n          Organization Slug\n        </label>\n        <input\n          type=\"text\"\n          id=\"slug\"\n          name=\"slug\"\n          defaultValue={organization?.slug}\n          disabled\n          className=\"w-full px-4 py-2 border border-gray-300 rounded-md bg-gray-50 text-gray-500\"\n        />\n        <p className=\"mt-1 text-sm text-gray-500\">\n          Organization slug cannot be changed\n        </p>\n      </div>\n\n      {message && (\n        <div\n          className={`p-4 rounded-md ${\n            message.includes('Error')\n              ? 'bg-red-50 text-red-800'\n              : 'bg-green-50 text-green-800'\n          }`}\n        >\n          {message}\n        </div>\n      )}\n\n      <div className=\"flex gap-4\">\n        <button\n          type=\"submit\"\n          disabled={isSaving}\n          className=\"px-6 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n        >\n          {isSaving ? 'Saving...' : 'Save Changes'}\n        </button>\n      </div>\n    </form>\n  )\n}\n```\n\n```typescript file=\"app/admin/members/page.tsx\"\nimport { auth } from '@clerk/nextjs/server'\nimport { OrganizationMembersList } from './members-list'\n\nexport default async function MembersPage() {\n  const { orgId, orgRole } = await auth()\n\n  return (\n    <div>\n      <div className=\"mb-8\">\n        <h1 className=\"text-3xl font-bold text-gray-900 mb-2\">\n          Organization Members\n        </h1>\n        <p className=\"text-gray-600\">\n          Manage your organization's members and their roles\n        </p>\n      </div>\n\n      <div className=\"bg-white rounded-lg shadow\">\n        <OrganizationMembersList />\n      </div>\n    </div>\n  )\n}\n```\n\n```typescript file=\"app/admin/members/members-list.tsx\"\n'use client'\n\nimport { useOrganization } from '@clerk/nextjs'\n\nexport function OrganizationMembersList() {\n  const { organization, membership, memberships } = useOrganization({\n    memberships: {\n      pageSize: 20,\n      keepPreviousData: true,\n    },\n  })\n\n  if (!organization || !memberships) {\n    return <div className=\"p-6\">Loading...</div>\n  }\n\n  return (\n    <div className=\"p-6\">\n      <div className=\"mb-4\">\n        <h2 className=\"text-xl font-semibold\">\n          Members ({memberships.count})\n        </h2>\n      </div>\n\n      <div className=\"overflow-x-auto\">\n        <table className=\"min-w-full divide-y divide-gray-200\">\n          <thead className=\"bg-gray-50\">\n            <tr>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Member\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Email\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Role\n              </th>\n              <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n                Joined\n              </th>\n            </tr>\n          </thead>\n          <tbody className=\"bg-white divide-y divide-gray-200\">\n            {memberships.data.map((member) => (\n              <tr key={member.id}>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <div className=\"flex items-center\">\n                    <img\n                      className=\"h-10 w-10 rounded-full\"\n                      src={member.publicUserData.imageUrl}\n                      alt=\"\"\n                    />\n                    <div className=\"ml-4\">\n                      <div className=\"text-sm font-medium text-gray-900\">\n                        {member.publicUserData.firstName}{' '}\n                        {member.publicUserData.lastName}\n                      </div>\n                    </div>\n                  </div>\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <div className=\"text-sm text-gray-900\">\n                    {member.publicUserData.identifier}\n                  </div>\n                </td>\n                <td className=\"px-6 py-4 whitespace-nowrap\">\n                  <span className=\"inline",
  "graders": [
    ["admin_page_file", true],
    ["admin_route_handler_file", false],
    ["middleware_file_name", true],
    ["import_auth_helper", true],
    ["redirect_to_sign_in", false],
    ["auth_protect_usage", false],
    ["has_permission_check", false],
    ["package_json_clerk_version", false],
    ["environment_variables", false],
    ["authorization_logic", false]
  ],
  "toolCalls": [
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    },
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    },
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    },
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    },
    {
      "toolName": "clerk_sdk_snippet",
      "args": {}
    },
    {
      "toolName": "clerk_sdk_snippet",
      "args": {}
    }
  ],
  "toolResults": [],
  "transcript": "# MCP Evaluation Transcript\n\n## System Prompt\n\n```\nYOU MUST output all files as fenced code blocks, like so\n\n```lang file=\"path/to/file.ts\"\n\n```\n```\n\n## User Prompt\n\n```markdown\n# Task\n\nBuild a Clerk-enabled Next.js App Router admin area that enforces both authentication and authorization for an organization settings page.\n```\n\n---\n\n## Conversation\n\n### Step 1 (tool-calls)\n\n**ü§ñ Assistant:**\n\nI'll help you build a Clerk-enabled Next.js App Router admin area with authentication and authorization for an organization settings page. Let me first check what relevant Clerk SDK snippets are available.\n\n\n**üîß Tool Calls:**\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n---\n\n### Step 2 (tool-calls)\n\n**üîß Tool Calls:**\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n---\n\n### Step 3 (tool-calls)\n\n**üîß Tool Calls:**\n\n`clerk_sdk_snippet`\n```json\n{}\n```\n\n`clerk_sdk_snippet`\n```json\n{}\n```\n\n---\n\n### Step 4 (length)\n\n**ü§ñ Assistant:**\n\nLet me create a comprehensive Clerk-enabled Next.js App Router admin area with authentication and authorization for you:\n\n```typescript file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs'\nimport './globals.css'\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>{children}</body>\n      </html>\n    </ClerkProvider>\n  )\n}\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMidd...\n\n_(truncated, 13463 chars total)_\n\n\n---\n\n## Grader Results\n\n**Score: 30.0%** (3/10)\n\n| Grader | Result |\n|--------|--------|\n| admin_page_file | ‚úÖ |\n| admin_route_handler_file | ‚ùå |\n| middleware_file_name | ‚úÖ |\n| import_auth_helper | ‚úÖ |\n| redirect_to_sign_in | ‚ùå |\n| auth_protect_usage | ‚ùå |\n| has_permission_check | ‚ùå |\n| package_json_clerk_version | ‚ùå |\n| environment_variables | ‚ùå |\n| authorization_logic | ‚ùå |\n"
}
