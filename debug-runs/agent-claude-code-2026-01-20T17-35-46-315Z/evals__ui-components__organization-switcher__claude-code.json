{
  "prompt": "YOU MUST output all files as fenced code blocks, like so\n\n```lang file=\"path/to/file.ts\"\n// file content\n```\n\nDo not ask clarifying questions. Complete the task with the information provided.\n\n---\n\n# Task\n\nBuild a Next.js navigation component for a B2B app that includes a Clerk OrganizationSwitcher. When a user selects or creates an organization, they should be redirected to that organization's dashboard using the org slug in the URL. Personal workspaces should be hidden since this is a B2B-only app.\n",
  "response": "I'll build a Next.js navigation component with Clerk's OrganizationSwitcher configured for B2B use. Let me create this for you.\n\n```tsx file=\"components/Navigation.tsx\"\n'use client';\n\nimport { OrganizationSwitcher } from '@clerk/nextjs';\nimport { useRouter } from 'next/navigation';\n\nexport function Navigation() {\n  const router = useRouter();\n\n  return (\n    <nav className=\"border-b bg-white\">\n      <div className=\"mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex items-center gap-8\">\n          <h1 className=\"text-xl font-semibold\">Your B2B App</h1>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <OrganizationSwitcher\n            hidePersonal={true}\n            afterCreateOrganizationUrl={(org) => `/org/${org.slug}`}\n            afterSelectOrganizationUrl={(org) => `/org/${org.slug}`}\n            afterSelectPersonalUrl=\"/org\"\n            appearance={{\n              elements: {\n                rootBox: {\n                  display: 'flex',\n                  alignItems: 'center',\n                },\n              },\n            }}\n          />\n        </div>\n      </div>\n    </nav>\n  );\n}\n```\n\n```tsx file=\"app/org/[slug]/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\n\nexport default async function OrganizationDashboard({\n  params,\n}: {\n  params: { slug: string };\n}) {\n  const { orgSlug } = await auth();\n\n  // Redirect if user is not in an organization\n  if (!orgSlug) {\n    redirect('/org');\n  }\n\n  // Redirect if the URL slug doesn't match the user's current org\n  if (orgSlug !== params.slug) {\n    redirect(`/org/${orgSlug}`);\n  }\n\n  return (\n    <div className=\"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8\">\n      <h1 className=\"mb-8 text-3xl font-bold\">Organization Dashboard</h1>\n      <div className=\"rounded-lg border bg-white p-6\">\n        <h2 className=\"mb-4 text-xl font-semibold\">Welcome to {orgSlug}</h2>\n        <p className=\"text-gray-600\">\n          This is your organization's dashboard. Build your B2B features here.\n        </p>\n      </div>\n    </div>\n  );\n}\n```\n\n```tsx file=\"app/org/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\n\nexport default async function OrganizationRoot() {\n  const { orgSlug } = await auth();\n\n  // If user has an active organization, redirect to it\n  if (orgSlug) {\n    redirect(`/org/${orgSlug}`);\n  }\n\n  return (\n    <div className=\"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8\">\n      <div className=\"rounded-lg border bg-white p-8 text-center\">\n        <h1 className=\"mb-4 text-2xl font-bold\">No Organization Selected</h1>\n        <p className=\"text-gray-600\">\n          Please create or select an organization to continue.\n        </p>\n      </div>\n    </div>\n  );\n}\n```\n\n```tsx file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs';\nimport { Navigation } from '@/components/Navigation';\nimport './globals.css';\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>\n          <Navigation />\n          <main>{children}</main>\n        </body>\n      </html>\n    </ClerkProvider>\n  );\n}\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';\nimport { NextResponse } from 'next/server';\n\nconst isProtectedRoute = createRouteMatcher(['/org(.*)']);\n\nexport default clerkMiddleware(async (auth, req) => {\n  const { userId, orgSlug } = await auth();\n\n  // Protect organization routes\n  if (isProtectedRoute(req)) {\n    if (!userId) {\n      const signInUrl = new URL('/sign-in', req.url);\n      signInUrl.searchParams.set('redirect_url', req.url);\n      return NextResponse.redirect(signInUrl);\n    }\n  }\n});\n\nexport const config = {\n  matcher: [\n    '/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n    '/(api|trpc)(.*)',\n  ],\n};\n```\n\nThis navigation component provides:\n\n1. **OrganizationSwitcher Configuration**:\n   - `hidePersonal={true}` - Hides personal workspaces for B2B-only\n   - `afterCreateOrganizationUrl` - Redirects to new org's dashboard after creation\n   - `afterSelectOrganizationUrl` - Redirects to selected org's dashboard\n\n2. **URL-based Organization Routing**:\n   - `/org/[slug]` - Organization dashboard using slug\n   - Automatic redirects if org slug doesn't match\n   - Fallback page when no organization is selected\n\n3. **Middleware Protection**:\n   - Protects all `/org/*` routes\n   - Redirects unauthenticated users to sign-in\n\nThe component automatically handles organization switching and redirects users to the appropriate dashboard based on the organization slug.\n",
  "graders": [
    [
      "org_switcher_component",
      true
    ],
    [
      "after_select_url",
      true
    ],
    [
      "after_create_url",
      true
    ],
    [
      "hide_personal",
      true
    ],
    [
      "org_slug_in_url",
      true
    ],
    [
      "appearance_prop",
      true
    ],
    [
      "import_from_clerk",
      true
    ],
    [
      "package_json_clerk_version",
      false
    ],
    [
      "environment_variables",
      false
    ],
    [
      "multi_tenant_nav",
      true
    ]
  ],
  "transcript": "# Claude Code Agent Transcript\n\n## Execution Info\n- **Duration**: 21.31s\n- **Exit Code**: 0\n- **Success**: true\n\n## Prompt\n```markdown\nYOU MUST output all files as fenced code blocks, like so\n\n```lang file=\"path/to/file.ts\"\n// file content\n```\n\nDo not ask clarifying questions. Complete the task with the information provided.\n\n---\n\n# Task\n\nBuild a Next.js navigation component for a B2B app that includes a Clerk OrganizationSwitcher. When a user selects or creates an organization, they should be redirected to that organization's dashboard using the org slug in the URL. Personal workspaces should be hidden since this is a B2B-only app.\n```\n\n## Output\n```\nI'll build a Next.js navigation component with Clerk's OrganizationSwitcher configured for B2B use. Let me create this for you.\n\n```tsx file=\"components/Navigation.tsx\"\n'use client';\n\nimport { OrganizationSwitcher } from '@clerk/nextjs';\nimport { useRouter } from 'next/navigation';\n\nexport function Navigation() {\n  const router = useRouter();\n\n  return (\n    <nav className=\"border-b bg-white\">\n      <div className=\"mx-auto flex h-16 max-w-7xl items-center justify-between px-4 sm:px-6 lg:px-8\">\n        <div className=\"flex items-center gap-8\">\n          <h1 className=\"text-xl font-semibold\">Your B2B App</h1>\n        </div>\n\n        <div className=\"flex items-center gap-4\">\n          <OrganizationSwitcher\n            hidePersonal={true}\n            afterCreateOrganizationUrl={(org) => `/org/${org.slug}`}\n            afterSelectOrganizationUrl={(org) => `/org/${org.slug}`}\n            afterSelectPersonalUrl=\"/org\"\n            appearance={{\n              elements: {\n                rootBox: {\n                  display: 'flex',\n                  alignItems: 'center',\n                },\n              },\n            }}\n          />\n        </div>\n      </div>\n    </nav>\n  );\n}\n```\n\n```tsx file=\"app/org/[slug]/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\n\nexport default async function OrganizationDashboard({\n  params,\n}: {\n  params: { slug: string };\n}) {\n  const { orgSlug } = await auth();\n\n  // Redirect if user is not in an organization\n  if (!orgSlug) {\n    redirect('/org');\n  }\n\n  // Redirect if the URL slug doesn't match the user's current org\n  if (orgSlug !== params.slug) {\n    redirect(`/org/${orgSlug}`);\n  }\n\n  return (\n    <div className=\"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8\">\n      <h1 className=\"mb-8 text-3xl font-bold\">Organization Dashboard</h1>\n      <div className=\"rounded-lg border bg-white p-6\">\n        <h2 className=\"mb-4 text-xl font-semibold\">Welcome to {orgSlug}</h2>\n        <p className=\"text-gray-600\">\n          This is your organization's dashboard. Build your B2B features here.\n        </p>\n      </div>\n    </div>\n  );\n}\n```\n\n```tsx file=\"app/org/page.tsx\"\nimport { auth } from '@clerk/nextjs/server';\nimport { redirect } from 'next/navigation';\n\nexport default async function OrganizationRoot() {\n  const { orgSlug } = await auth();\n\n  // If user has an active organization, redirect to it\n  if (orgSlug) {\n    redirect(`/org/${orgSlug}`);\n  }\n\n  return (\n    <div className=\"mx-auto max-w-7xl px-4 py-8 sm:px-6 lg:px-8\">\n      <div className=\"rounded-lg border bg-white p-8 text-center\">\n        <h1 className=\"mb-4 text-2xl font-bold\">No Organization Selected</h1>\n        <p className=\"text-gray-600\">\n          Please create or select an organization to continue.\n        </p>\n      </div>\n    </div>\n  );\n}\n```\n\n```tsx file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs';\nimport { Navigation } from '@/components/Navigation';\nimport './globals.css';\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode;\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>\n          <Navigation />\n          <main>{children}</main>\n        </body>\n      </html>\n    </ClerkProvider>\n  );\n}\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server';\nimport { NextResponse } from 'next/server';\n\nconst isProtectedRoute = createRouteMatcher(['/org(.*)']);\n\nexport default clerkMiddleware(async (auth, req) => {\n  const { userId, orgSlug } = await auth();\n\n  // Protect organization routes\n  if (isProtectedRoute(req)) {\n    if (!userId) {\n      const signInUrl = new URL('/sign-in', req.url);\n      signInUrl.searchParams.set('redirect_url', req.url);\n      return NextResponse.redirect(signInUrl);\n    }\n  }\n});\n\nexport const config = {\n  matcher: [\n    '/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n    '/(api|trpc)(.*)',\n  ],\n};\n```\n\nThis navigation component provides:\n\n1. **OrganizationSwitcher Configuration**:\n   - `hidePersonal={true}` - Hides personal workspaces for B2B-only\n   - `afterCreateOrganizationUrl` - Redirects to new org's dashboard after creation\n   - `afterSelectOrganizationUrl` - Redirects to selected org's dashboard\n\n2. **URL-based Organization Routing**:\n   - `/org/[slug]` - Organization dashboard using slug\n   - Automatic redirects if org slug doesn't match\n   - Fallback page when no organization is selected\n\n3. **Middleware Protection**:\n   - Protects all `/org/*` routes\n   - Redirects unauthenticated users to sign-in\n\nThe component automatically handles organization switching and redirects users to the appropriate dashboard based on the organization slug.\n\n```\n\n## Grader Results\n**Score: 80.0%** (8/10)\n\n| Grader | Result |\n|--------|--------|\n| org_switcher_component | PASS |\n| after_select_url | PASS |\n| after_create_url | PASS |\n| hide_personal | PASS |\n| org_slug_in_url | PASS |\n| appearance_prop | PASS |\n| import_from_clerk | PASS |\n| package_json_clerk_version | FAIL |\n| environment_variables | FAIL |\n| multi_tenant_nav | PASS |\n"
}