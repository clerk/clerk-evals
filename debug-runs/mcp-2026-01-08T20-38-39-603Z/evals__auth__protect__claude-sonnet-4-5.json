{
  "prompt": "# Task\n\nBuild a Clerk-enabled Next.js App Router admin area that enforces both authentication and authorization for an organization settings page.\n",
  "response": "I'll help you build a Clerk-enabled Next.js App Router admin area with authentication and authorization for an organization settings page. Let me first check what Clerk SDK snippets are available.\n\nLet me try listing the available snippets without filters:\n\nI'll create a comprehensive Clerk-enabled Next.js App Router admin area with authentication and authorization based on best practices:\n\n```typescript file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs'\nimport './globals.css'\nimport type { Metadata } from 'next'\n\nexport const metadata: Metadata = {\n  title: 'Admin Portal',\n  description: 'Organization Admin Portal',\n}\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <ClerkProvider>\n      <html lang=\"en\">\n        <body>{children}</body>\n      </html>\n    </ClerkProvider>\n  )\n}\n```\n\n```typescript file=\"middleware.ts\"\nimport { clerkMiddleware, createRouteMatcher } from '@clerk/nextjs/server'\n\n// Define routes that require authentication\nconst isProtectedRoute = createRouteMatcher([\n  '/admin(.*)',\n  '/dashboard(.*)',\n])\n\nexport default clerkMiddleware((auth, req) => {\n  // Protect admin routes\n  if (isProtectedRoute(req)) {\n    auth().protect()\n  }\n})\n\nexport const config = {\n  matcher: [\n    // Skip Next.js internals and static files\n    '/((?!_next|[^?]*\\\\.(?:html?|css|js(?!on)|jpe?g|webp|png|gif|svg|ttf|woff2?|ico|csv|docx?|xlsx?|zip|webmanifest)).*)',\n    // Always run for API routes\n    '/(api|trpc)(.*)',\n  ],\n}\n```\n\n```typescript file=\"app/(authenticated)/layout.tsx\"\nimport { UserButton } from '@clerk/nextjs'\nimport Link from 'next/link'\n\nexport default function AuthenticatedLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      <nav className=\"bg-white shadow-sm border-b\">\n        <div className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8\">\n          <div className=\"flex justify-between h-16 items-center\">\n            <div className=\"flex space-x-8\">\n              <Link \n                href=\"/dashboard\" \n                className=\"text-gray-900 hover:text-gray-700 font-medium\"\n              >\n                Dashboard\n              </Link>\n              <Link \n                href=\"/admin\" \n                className=\"text-gray-900 hover:text-gray-700 font-medium\"\n              >\n                Admin\n              </Link>\n            </div>\n            <UserButton afterSignOutUrl=\"/\" />\n          </div>\n        </div>\n      </nav>\n      <main className=\"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8\">\n        {children}\n      </main>\n    </div>\n  )\n}\n```\n\n```typescript file=\"app/(authenticated)/admin/layout.tsx\"\nimport { auth } from '@clerk/nextjs/server'\nimport { redirect } from 'next/navigation'\n\nexport default async function AdminLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  const { userId, orgRole } = auth()\n\n  // Ensure user is authenticated\n  if (!userId) {\n    redirect('/sign-in')\n  }\n\n  // Ensure user has admin role in organization\n  if (orgRole !== 'org:admin') {\n    redirect('/unauthorized')\n  }\n\n  return (\n    <div>\n      <div className=\"mb-6\">\n        <h1 className=\"text-3xl font-bold text-gray-900\">Admin Area</h1>\n        <p className=\"text-gray-600 mt-2\">\n          Manage organization settings and configurations\n        </p>\n      </div>\n      {children}\n    </div>\n  )\n}\n```\n\n```typescript file=\"app/(authenticated)/admin/organization-settings/page.tsx\"\nimport { auth, clerkClient } from '@clerk/nextjs/server'\nimport { redirect } from 'next/navigation'\nimport OrganizationSettingsForm from '@/components/OrganizationSettingsForm'\nimport MembersList from '@/components/MembersList'\n\nexport default async function OrganizationSettingsPage() {\n  const { userId, orgId, orgRole } = auth()\n\n  // Double-check authentication and authorization\n  if (!userId) {\n    redirect('/sign-in')\n  }\n\n  if (!orgId) {\n    return (\n      <div className=\"bg-yellow-50 border border-yellow-200 rounded-lg p-4\">\n        <h2 className=\"text-lg font-semibold text-yellow-900\">No Organization Selected</h2>\n        <p className=\"text-yellow-700 mt-2\">\n          Please select an organization to manage its settings.\n        </p>\n      </div>\n    )\n  }\n\n  if (orgRole !== 'org:admin') {\n    redirect('/unauthorized')\n  }\n\n  // Fetch organization details\n  const organization = await clerkClient.organizations.getOrganization({\n    organizationId: orgId,\n  })\n\n  // Fetch organization members\n  const membersList = await clerkClient.organizations.getOrganizationMembershipList({\n    organizationId: orgId,\n  })\n\n  return (\n    <div className=\"space-y-8\">\n      {/* Organization Info Card */}\n      <div className=\"bg-white shadow rounded-lg p-6\">\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Organization Information\n        </h2>\n        <div className=\"grid grid-cols-2 gap-4\">\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Organization Name</p>\n            <p className=\"mt-1 text-lg text-gray-900\">{organization.name}</p>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Organization ID</p>\n            <p className=\"mt-1 text-sm text-gray-700 font-mono\">{organization.id}</p>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Created At</p>\n            <p className=\"mt-1 text-sm text-gray-700\">\n              {new Date(organization.createdAt).toLocaleDateString()}\n            </p>\n          </div>\n          <div>\n            <p className=\"text-sm font-medium text-gray-500\">Members</p>\n            <p className=\"mt-1 text-lg text-gray-900\">{membersList.totalCount}</p>\n          </div>\n        </div>\n      </div>\n\n      {/* Settings Form */}\n      <div className=\"bg-white shadow rounded-lg p-6\">\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Organization Settings\n        </h2>\n        <OrganizationSettingsForm \n          organizationId={orgId}\n          initialData={{\n            name: organization.name,\n            slug: organization.slug,\n          }}\n        />\n      </div>\n\n      {/* Members List */}\n      <div className=\"bg-white shadow rounded-lg p-6\">\n        <h2 className=\"text-xl font-semibold text-gray-900 mb-4\">\n          Organization Members\n        </h2>\n        <MembersList \n          members={membersList.data}\n          organizationId={orgId}\n        />\n      </div>\n    </div>\n  )\n}\n```\n\n```typescript file=\"components/OrganizationSettingsForm.tsx\"\n'use client'\n\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\n\ninterface OrganizationSettingsFormProps {\n  organizationId: string\n  initialData: {\n    name: string\n    slug: string | null\n  }\n}\n\nexport default function OrganizationSettingsForm({ \n  organizationId, \n  initialData \n}: OrganizationSettingsFormProps) {\n  const router = useRouter()\n  const [name, setName] = useState(initialData.name)\n  const [slug, setSlug] = useState(initialData.slug || '')\n  const [loading, setLoading] = useState(false)\n  const [error, setError] = useState<string | null>(null)\n  const [success, setSuccess] = useState(false)\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault()\n    setLoading(true)\n    setError(null)\n    setSuccess(false)\n\n    try {\n      const response = await fetch('/api/admin/update-organization', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          organizationId,\n          name,\n          slug,\n        }),\n      })\n\n      if (!response.ok) {\n        const data = await response.json()\n        throw new Error(data.error || 'Failed to update organization')\n      }\n\n      setSuccess(true)\n      router.refresh()\n    } catch (err) {\n      setError(err instanceof Error ? err.message : 'An error occurred')\n    } finally {\n      setLoading(false)\n    }\n  }\n\n  return (\n    <form onSubmit={handleSubmit} className=\"space-y-4\">\n      {error && (\n        <div className=\"bg-red-50 border border-red-200 text-red-700 px-4 py-3 rounded\">\n          {error}\n        </div>\n      )}\n      \n      {success && (\n        <div className=\"bg-green-50 border border-green-200 text-green-700 px-4 py-3 rounded\">\n          Organization updated successfully!\n        </div>\n      )}\n\n      <div>\n        <label htmlFor=\"name\" className=\"block text-sm font-medium text-gray-700\">\n          Organization Name\n        </label>\n        <input\n          type=\"text\"\n          id=\"name\"\n          value={name}\n          onChange={(e) => setName(e.target.value)}\n          className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          required\n        />\n      </div>\n\n      <div>\n        <label htmlFor=\"slug\" className=\"block text-sm font-medium text-gray-700\">\n          Organization Slug\n        </label>\n        <input\n          type=\"text\"\n          id=\"slug\"\n          value={slug}\n          onChange={(e) => setSlug(e.target.value)}\n          className=\"mt-1 block w-full rounded-md border-gray-300 shadow-sm focus:border-blue-500 focus:ring-blue-500\"\n          placeholder=\"my-organization\"\n        />\n        <p className=\"mt-1 text-sm text-gray-500\">\n          A unique identifier for your organization\n        </p>\n      </div>\n\n      <button\n        type=\"submit\"\n        disabled={loading}\n        className=\"bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 disabled:opacity-50 disabled:cursor-not-allowed\"\n      >\n        {loading ? 'Saving...' : 'Save Changes'}\n      </button>\n    </form>\n  )\n}\n```\n\n```typescript file=\"components/MembersList.tsx\"\n'use client'\n\nimport { OrganizationMembership } from '@clerk/nextjs/server'\nimport { useState } from 'react'\nimport { useRouter } from 'next/navigation'\n\ninterface MembersListProps {\n  members: OrganizationMembership[]\n  organizationId: string\n}\n\nexport default function MembersList({ members, organizationId }: MembersListProps) {\n  const router = useRouter()\n  const [loading, setLoading] = useState<string | null>(null)\n\n  const handleRoleChange = async (userId: string, newRole: string) => {\n    setLoading(userId)\n    \n    try {\n      const response = await fetch('/api/admin/update-member-role', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          organizationId,\n          userId,\n          role: newRole,\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to update member role')\n      }\n\n      router.refresh()\n    } catch (err) {\n      console.error(err)\n      alert('Failed to update member role')\n    } finally {\n      setLoading(null)\n    }\n  }\n\n  const handleRemoveMember = async (userId: string) => {\n    if (!confirm('Are you sure you want to remove this member?')) {\n      return\n    }\n\n    setLoading(userId)\n    \n    try {\n      const response = await fetch('/api/admin/remove-member', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          organizationId,\n          userId,\n        }),\n      })\n\n      if (!response.ok) {\n        throw new Error('Failed to remove member')\n      }\n\n      router.refresh()\n    } catch (err) {\n      console.error(err)\n      alert('Failed to remove member')\n    } finally {\n      setLoading(null)\n    }\n  }\n\n  return (\n    <div className=\"overflow-x-auto\">\n      <table className=\"min-w-full divide-y divide-gray-200\">\n        <thead className=\"bg-gray-50\">\n          <tr>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Member\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Email\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Role\n            </th>\n            <th className=\"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Joined\n            </th>\n            <th className=\"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider\">\n              Actions\n            </th>\n          </tr>\n        </thead>\n        <tbody className=\"bg-white divide-y divide-gray-200\">\n          {members.map((member) => (\n            <tr key={member.id}>\n              <td className=\"px-6 py-4 whitespace-nowrap\">\n                <div className=\"text-sm font-medium text-gray-900\">\n                  {member.publicUserData?.firstName} {member.publicUserData?.lastName}\n                </div>\n              </td>\n              <td className=\"px-6 py-4 whitespace-nowrap\">\n                <div className=\"text-sm text-gray-500\">\n                  {member.publicUserData?.identifier}\n                </div>\n              </td>\n              <td className=\"px-6 py-4 whitespace-nowrap\">\n                <select\n                  value={member.role}\n                  onChange={(e) => handleRoleChange(member.publicUserData!.userId!, e.target.value)}\n                  disabled={loading === member.publicUserData?.userId}\n                  className=\"text-sm border-gray-300 rounded-md\"\n                >\n                  <option value=\"org:member\">Member</option>\n                  <option value=\"org:admin\">Admin</option>\n                </select>\n              </td>\n              <td className=\"px-6 py-4 whitespace-nowrap text-sm text-gray-500\">\n                {new Date(member.createdAt).toLocaleDateString()}\n              </td>\n              <td className=\"px-6 py-4 whitespace-nowrap text-right text-sm\">\n                <button\n                  onClick={() => handleRemoveMember(member.publicUserData!.userId!)}\n                  disabled={loading === member.publicUserData?.userId}\n                  className=\"",
  "graders": [
    ["admin_page_file", false],
    ["admin_route_handler_file", false],
    ["middleware_file_name", true],
    ["import_auth_helper", true],
    ["redirect_to_sign_in", false],
    ["auth_protect_usage", false],
    ["has_permission_check", false],
    ["package_json_clerk_version", false],
    ["environment_variables", false],
    ["authorization_logic", false]
  ],
  "toolCalls": [
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    },
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    },
    {
      "toolName": "clerk_sdk_snippet",
      "args": {}
    },
    {
      "toolName": "list_clerk_sdk_snippets",
      "args": {}
    }
  ],
  "toolResults": [],
  "transcript": "# MCP Evaluation Transcript\n\n## System Prompt\n\n```\nYOU MUST output all files as fenced code blocks, like so\n\n```lang file=\"path/to/file.ts\"\n\n```\n```\n\n## User Prompt\n\n```markdown\n# Task\n\nBuild a Clerk-enabled Next.js App Router admin area that enforces both authentication and authorization for an organization settings page.\n```\n\n---\n\n## Conversation\n\n### Step 1 (tool-calls)\n\n**ðŸ¤– Assistant:**\n\nI'll help you build a Clerk-enabled Next.js App Router admin area with authentication and authorization for an organization settings page. Let me first check what Clerk SDK snippets are available.\n\n\n**ðŸ”§ Tool Calls:**\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n`clerk_sdk_snippet`\n```json\n{}\n```\n\n---\n\n### Step 2 (tool-calls)\n\n**ðŸ¤– Assistant:**\n\nLet me try listing the available snippets without filters:\n\n\n**ðŸ”§ Tool Calls:**\n\n`list_clerk_sdk_snippets`\n```json\n{}\n```\n\n---\n\n### Step 3 (length)\n\n**ðŸ¤– Assistant:**\n\nI'll create a comprehensive Clerk-enabled Next.js App Router admin area with authentication and authorization based on best practices:\n\n```typescript file=\"app/layout.tsx\"\nimport { ClerkProvider } from '@clerk/nextjs'\nimport './globals.css'\nimport type { Metadata } from 'next'\n\nexport const metadata: Metadata = {\n  title: 'Admin Portal',\n  description: 'Organization Admin Portal',\n}\n\nexport default function RootLayout({\n  children,\n}: {\n  children: React.ReactNode\n}) {\n  return (\n    <ClerkProvi...\n\n_(truncated, 13770 chars total)_\n\n\n---\n\n## Grader Results\n\n**Score: 20.0%** (2/10)\n\n| Grader | Result |\n|--------|--------|\n| admin_page_file | âŒ |\n| admin_route_handler_file | âŒ |\n| middleware_file_name | âœ… |\n| import_auth_helper | âœ… |\n| redirect_to_sign_in | âŒ |\n| auth_protect_usage | âŒ |\n| has_permission_check | âŒ |\n| package_json_clerk_version | âŒ |\n| environment_variables | âŒ |\n| authorization_logic | âŒ |\n"
}
